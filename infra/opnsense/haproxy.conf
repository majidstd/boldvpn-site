#
# Automatically generated configuration.
# Do not edit this file manually.
#

global
    uid                         80
    gid                         80
    chroot                      /var/haproxy
    daemon
    stats                       socket /var/run/haproxy.socket group proxy mode 775 level admin
    nbthread                    1
    hard-stop-after             60s
    no strict-limits
    httpclient.resolvers.prefer   ipv4
    tune.ssl.default-dh-param   2048
    spread-checks               2
    tune.bufsize                16384
    tune.lua.maxmem             0
    log                         /var/run/log local0 info
    lua-prepend-path            /tmp/haproxy/lua/?.lua
    ssl-default-bind-options prefer-client-ciphers ssl-min-ver TLSv1.2
    ssl-default-bind-ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256
    ssl-default-bind-ciphersuites TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256

defaults
    log     global
    option redispatch -1
    timeout client 30s
    timeout connect 30s
    timeout server 30s
    retries 3
    default-server init-addr last,libc

# autogenerated entries for ACLs


# autogenerated entries for config in backends/frontends

# autogenerated entries for stats




# Frontend: api_frontend (BoldVPN API Public Frontend - HTTPS SSL Offloading)
frontend api_frontend
    http-response set-header Strict-Transport-Security "max-age=15768000"
    bind 0.0.0.0:443 name 0.0.0.0:443 ssl prefer-client-ciphers ssl-min-ver TLSv1.2 ssl-max-ver TLSv1.3 ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256 ciphersuites TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256 alpn h2,http/1.1 crt-list /tmp/haproxy/ssl/690cf29e6b1c32.16738397.certlist 
    mode http
    option http-keep-alive
    default_backend api_backend_pool

    # logging options
    option httplog
    option socket-stats
    # WARNING: pass through options below this line
    http-request set-header X-Forwarded-Proto https

# Frontend: api_http_redirect (Redirect HTTP to HTTPS)
frontend api_http_redirect
    bind 0.0.0.0:80 name 0.0.0.0:80 
    mode http
    option http-keep-alive
    # WARNING: pass through options below this line
    redirect scheme https code 301

# Backend: api_backend_pool (BoldVPN API Backend Pool)
backend api_backend_pool
    option log-health-checks
    # health check: api health port 3000
    option httpchk
    http-check send meth GET uri /api/health ver HTTP/1.0
    http-check expect rstatus 200
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m store conn_cnt,conn_cur,conn_rate(10s),sess_cnt,sess_rate(10s),http_req_cnt,http_req_rate(10s),http_err_cnt,http_err_rate(10s),bytes_in_cnt,bytes_in_rate(1m) 
    stick on src
    timeout connect 5s
    timeout check 5s
    timeout server 30s
    retries 3
    # WARNING: pass through options below this line
    option forwardfor
    option http-server-close
    http-reuse safe
    server freebsd_api 192.168.50.2:3000 check inter 10000 port 3000 



listen local_statistics
    bind            127.0.0.1:8822
    mode            http
    stats uri       /haproxy?stats
    stats realm     HAProxy\ statistics
    stats admin     if TRUE

# remote statistics are DISABLED